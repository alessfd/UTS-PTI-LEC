<!DOCTYPE html> 
<html>
<head>
    <link href="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-2.0.3/b-3.0.1/b-colvis-3.0.1/r-3.0.0/sp-2.3.0/datatables.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Wix+Madefor+Text:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet"/>
    <title>Tabel Data Mahasiswa</title>

</head>
<body class="bg-image d-flex flex-column justify-content-center align-items-center" onload="startTime()">
    
    <!-- Header -->
	<div id="header">
        <img src="gambar/UMN.png" style="width: 300px;">
    </div>

    <!-- Body -->
    
    <div class="w-75">
        <!-- Tabel -->
        <div id="tabel">
            <div class="px-4 d-flex align-items-center justify-content-between">
                <h2>Data Mahasiswa</h2>
                <b><div id="txt"></div></b>
            </div>
            <hr>
            <p class="mx-4">Semua mahasiswa yang terdata di dalam tabel dinyatakan lulus 100% dengan IPK 4.</p>
            <hr>

            <!-- Tabel -->
            <div class="d-flex justify-content-center">
                <div id="yes" class="p-0 m-0 w-75">
                    <table id="studentTable" class="table cell-border table-striped" style="width: 100%; margin: 0px;">
                        <thead>
                            <tr>
                                <th>NIM</th>
                                <th>Nama</th>
                                <th>Alamat</th>
                                <th>Pengaturan</th> 
                            </tr>
                        </thead>
                        <tbody id="studentBody">
                            <tr><td>00000106265</td><td>Alessandro Fayez Devanno</td><td>Bintaro</td><td><button class="btn btn-info btn-sm" onclick="openModal(this)">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteData(this)">Delete</button></td></tr>
                            <tr><td>00000102827</td><td>Samuel Susilo</td><td>Serpong</td><td><button class="btn btn-info btn-sm" onclick="openModal(this)">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteData(this)">Delete</button></td></tr>
                            <tr><td>00000098874</td><td>Darryl Cornelius Setiawan</td><td>Bintaro</td><td><button class="btn btn-info btn-sm" onclick="openModal(this)">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteData(this)">Delete</button></td></tr>
                            <tr><td>00000104885</td><td>Hosea Dunatus Simanjuntak</td><td>Serpong</td><td><button class="btn btn-info btn-sm" onclick="openModal(this)">Edit</button><button class="btn btn-danger btn-sm" onclick="deleteData(this)">Delete</button></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <hr>

            
        
        
        </div>
        
        <!-- Edit Entry -->
        <div id="modalWrapper">
            <div id="modal" class="modalForm align-items-center justify-content-center">
                <form id="editForm" class="px-3 py-3 m-3 flex-column">
                    <h3>Edit Entry</h3>
                    <hr>
                    <div class="w-100">
                        <div class="row mt-0 mb-2">
                            <div class="col-3 pe-0 mid"><label for="nimEdit">NIM</label></div>
                            <div class="col ps-0 m-0"><input disabled class="col form-control" type="text" id="nimEdit" placeholder="Nomor Induk Mahasiswa"></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-3 pe-0 mid"><label class="col" for="nameEdit">Nama Lengkap</label></div>
                            <div class="col ps-0 m-0"><input class="col form-control" type="text" id="nameEdit" placeholder="Nama Lengkap"></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-3 pe-0 mid"><label class="col" for="addressEdit">Alamat</label></div>
                            <div class="col ps-0 m-0"><input class="form-control w-100" type="text" id="addressEdit" placeholder="Alamat"></div>
                        </div>
                    </div>
                    <hr>
                    <div id="formButtons">
                        <button type="button" class="btn btn-primary" onclick="editData()">Save</button>
                        <button type="button" class="btn btn-danger" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Entry -->
        <div class="container mb-4">
            <form id="studentForm" class="d-flex px-3 py-3 mt-4 flex-column">
                <h3>Add Entry</h3>
                <hr>
                <div>
                    <div class="row mt-0 mb-2">
                        <div id="addEntry" class="col-auto pe-0 mid"><label for="nimInput">NIM</label></div>
                        <div class="col ps-0 m-0"><input class="col form-control" type="text" id="nimInput" placeholder="Nomor Induk Mahasiswa"></div>
                    </div>
                    <div class="row mb-2">
                        <div id="addEntry" class="col-auto pe-0 mid"><label class="col" for="nameInput">Nama Lengkap</label></div>
                        <div class="col ps-0 m-0"><input class="col form-control" type="text" id="nameInput" placeholder="Nama Lengkap"></div>
                    </div>
                    <div class="row mb-2">
                        <div id="addEntry" class="col-auto pe-0 mid"><label class="col" for="addressInput">Alamat</label></div>
                        <div class="col ps-0 m-0"><input class="form-control w-100" type="text" id="addressInput" placeholder="Alamat"></div>
                    </div>
                </div>
                <hr>
                <div id="formButtons">
                    <button type="button" class="btn btn-primary" onclick="addData()">Add</button>
                    <button type="button" class="btn btn-secondary" onclick="clearInputs()">Clear</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alert Box -->
    <div>
        <div id="alertBox">
            <div id="alertHeader" class="bg-primary p-2">
                <h5 id="alertName">Alert</h5>
            </div>
            <div class="p-3">
                <p id="alertMessage">Alert telah muncul!</p>
            </div>
            <div class="p-3 pt-0 d-flex justify-content-end">
                <button id="alertButton" type="button" class="btn btn-danger" onclick="alertClose()">Close</button>
            </div>
        </div>
    </div>
    

	<script> 
        let editRow;
        console.log("lmaoxd");
		function addData(){
            let nim=document.getElementById("nimInput").value;
			let name=document.getElementById("nameInput").value;
			let alamat=document.getElementById("addressInput").value;
            if(nim==""||name==""||alamat==""){
                alertShow("Error!","Data tidak boleh kosong.","warning");
                return;
            }
            if(nim-nim!=0){
                alertShow("Error!","NIM tidak boleh mengandung huruf.","warning");
                return;
            }
            if(nim.length>11){
                alertShow("Error!","NIM terlalu panjang. (Max 11 digit)","warning");
                return;
            }

            let table = new DataTable('#studentTable');
 
            table.row.add({
                    nim: nim.padStart(11,'0'),
                    name: name,
                    alamat: alamat,
                    pengaturan: '<button class="btn btn-info btn-sm" onclick="openModal(this)">Edit</button>'+'<button class="btn btn-danger btn-sm" onclick="deleteData(this)">Delete</button>'
                })
            .draw();

            alertShow("Added!","Mahasiswa baru telah ditambahkan!","primary");

			clearInputs();
		}

        function openModal(button){
            // var modal = document.getElementById("modal");
            // modal.style.display = "flex";
            $(modalWrapper).fadeIn();

            let row = editRow = button.parentNode.parentNode;
			
            let nimEdit=row.childNodes[0].innerText;
			let nameEdit=row.childNodes[1].innerText;
			let addressEdit=row.childNodes[2].innerText;

            document.getElementById("nimEdit").value = nimEdit; 
			document.getElementById("nameEdit").value = nameEdit; 
			document.getElementById("addressEdit").value = addressEdit; 
        }

		function editData(button){
            let table = new DataTable('#studentTable');
			row = editRow;
			
			let nameEdit=document.getElementById("nameEdit").value;
			let addressEdit=document.getElementById("addressEdit").value;

            var data={
                "nim": row.childNodes[0].innerText,
                "name": nameEdit,
                "alamat": addressEdit,
                "pengaturan": row.childNodes[3].innerHTML,
            }

            table.row(row)
            .data(data)
            .draw();

            // var modal = document.getElementById("modal");
            // modal.style.display = "none";
            $(modalWrapper).fadeOut();

            alertShow("Edited!","Data mahasiswa berhasil di-edit.","info");

            // clearEdits();
		}

        function closeModal(){
            // var modal = document.getElementById("modal");
            // modal.style.display = "none";
            $(modalWrapper).fadeOut();
            // clearEdits();
        }

		function deleteData(button){ 
			let table = new DataTable('#studentTable');
            let row = button.parentNode.parentNode; 
            table.row(row)
            .remove()
            .draw();
            alertShow("Deleted!","Data mahasiswa berhasil dihapus.","danger");
		}

		function clearInputs(){
            document.getElementById("nimInput").value = ""; 
			document.getElementById("nameInput").value = ""; 
			document.getElementById("addressInput").value = ""; 
		}

        function alertShow(name, message, alertColor){
            $(alertMessage).text(message);
            $(alertName).text(name);
            $(alertHeader).attr('class', "bg-"+alertColor+" p-2");
            $(alertBox).fadeIn(100);
        }

        function alertClose(){
            $(alertBox).fadeOut(100);
        }

        // function clearEdits(){
        //     document.getElementById("nimEdit").value = ""; 
		// 	document.getElementById("nameEdit").value = ""; 
		// 	document.getElementById("addressEdit").value = ""; 
        // }

        function startTime(){
            const today = new Date();
            let h = today.getHours();
            let m = today.getMinutes();
            let s = today.getSeconds();
            m = checkTime(m);
            s = checkTime(s);
            document.getElementById("txt").innerHTML =  h + ":" + m + ":" + s;
            setTimeout(startTime, 1000);
            }

            function checkTime(i){
            if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
            return i;
            }
	</script>
    <script src="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-2.0.3/b-3.0.1/b-colvis-3.0.1/r-3.0.0/sp-2.3.0/datatables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="script.js"></script>
</body> 

</html>
